(function(){function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i||n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}return n})()({1:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(){this.isAborted=!1}return n.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(n.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),n}();i.AbortController=r},{}],2:[function(n,t,i){"use strict";var r=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),u,f;Object.defineProperty(i,"__esModule",{value:!0});u=function(n){function t(t,i){var u=this.constructor,r=this,f=u.prototype;return r=n.call(this,t)||this,r.statusCode=i,r.__proto__=f,r}return r(t,n),t}(Error);i.HttpError=u;f=function(n){function t(t){var u=this.constructor,i,r;return t===void 0&&(t="A timeout occurred."),i=this,r=u.prototype,i=n.call(this,t)||this,i.__proto__=r,i}return r(t,n),t}(Error);i.TimeoutError=f},{}],3:[function(n,t,i){"use strict";var h=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),f=this&&this.__assign||Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},u,s;Object.defineProperty(i,"__esModule",{value:!0});var r=n("./Errors"),e=n("./ILogger"),o=function(){function n(n,t,i){this.statusCode=n;this.statusText=t;this.content=i}return n}();i.HttpResponse=o;u=function(){function n(){}return n.prototype.get=function(n,t){return this.send(f({},t,{method:"GET",url:n}))},n.prototype.post=function(n,t){return this.send(f({},t,{method:"POST",url:n}))},n}();i.HttpClient=u;s=function(n){function t(t){var i=n.call(this)||this;return i.logger=t,i}return h(t,n),t.prototype.send=function(n){var t=this;return new Promise(function(i,u){var f=new XMLHttpRequest;f.open(n.method,n.url,!0);f.withCredentials=!0;f.setRequestHeader("X-Requested-With","XMLHttpRequest");n.headers&&Object.keys(n.headers).forEach(function(t){return f.setRequestHeader(t,n.headers[t])});n.responseType&&(f.responseType=n.responseType);n.abortSignal&&(n.abortSignal.onabort=function(){f.abort()});n.timeout&&(f.timeout=n.timeout);f.onload=function(){n.abortSignal&&(n.abortSignal.onabort=null);f.status>=200&&f.status<300?i(new o(f.status,f.statusText,f.response||f.responseText)):u(new r.HttpError(f.statusText,f.status))};f.onerror=function(){t.logger.log(e.LogLevel.Warning,"Error from HTTP request. "+f.status+": "+f.statusText);u(new r.HttpError(f.statusText,f.status))};f.ontimeout=function(){t.logger.log(e.LogLevel.Warning,"Timeout from HTTP request.");u(new r.TimeoutError)};f.send(n.content||"")})},t}(u);i.DefaultHttpClient=s},{"./Errors":2,"./ILogger":7}],4:[function(n,t,i){"use strict";var f=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},e=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e};Object.defineProperty(i,"__esModule",{value:!0});var s=n("./HttpClient"),u=n("./ILogger"),h=n("./Loggers"),r=n("./Transports"),o=n("./Utils"),c=function(){function n(n,t){t===void 0&&(t={});this.features={};o.Arg.isRequired(n,"url");this.logger=h.LoggerFactory.createLogger(t.logger);this.baseUrl=this.resolveUrl(n);t=t||{};t.accessTokenFactory=t.accessTokenFactory||function(){return null};this.httpClient=t.httpClient||new s.DefaultHttpClient(this.logger);this.connectionState=2;this.options=t}return n.prototype.start=function(n){return(o.Arg.isRequired(n,"transferFormat"),o.Arg.isIn(n,r.TransferFormat,"transferFormat"),this.logger.log(u.LogLevel.Trace,"Starting connection with transfer format '"+r.TransferFormat[n]+"'."),this.connectionState!==2)?Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state.")):(this.connectionState=0,this.startPromise=this.startInternal(n),this.startPromise)},n.prototype.startInternal=function(n){return f(this,void 0,void 0,function(){var h=this,i,t,s,f,o;return e(this,function(e){switch(e.label){case 0:return(e.trys.push([0,6,,7]),!(this.options.transport===r.TransportType.WebSockets))?[3,2]:(this.url=this.baseUrl,this.transport=this.constructTransport(r.TransportType.WebSockets),[4,this.transport.connect(this.url,n,this)]);case 1:return e.sent(),[3,5];case 2:return i=this.options.accessTokenFactory(),t=void 0,i&&(t=(o={},o.Authorization="Bearer "+i,o)),[4,this.getNegotiationResponse(t)];case 3:return(s=e.sent(),this.connectionState===2)?[2]:[4,this.createTransport(this.options.transport,s,n,t)];case 4:e.sent();e.label=5;case 5:return this.transport.onreceive=this.onreceive,this.transport.onclose=function(n){return h.stopConnection(!0,n)},this.changeState(0,1),[3,7];case 6:f=e.sent();this.logger.log(u.LogLevel.Error,"Failed to start the connection: "+f);this.connectionState=2;this.transport=null;throw f;case 7:return[2]}})})},n.prototype.getNegotiationResponse=function(n){return f(this,void 0,void 0,function(){var t,r,i;return e(this,function(f){switch(f.label){case 0:t=this.resolveNegotiateUrl(this.baseUrl);this.logger.log(u.LogLevel.Trace,"Sending negotiation request: "+t);f.label=1;case 1:return f.trys.push([1,3,,4]),[4,this.httpClient.post(t,{content:"",headers:n})];case 2:return r=f.sent(),[2,JSON.parse(r.content)];case 3:i=f.sent();this.logger.log(u.LogLevel.Error,"Failed to complete negotiation with the server: "+i);throw i;case 4:return[2]}})})},n.prototype.updateConnectionId=function(n){this.connectionId=n.connectionId;this.url=this.baseUrl+(this.baseUrl.indexOf("?")===-1?"?":"&")+("id="+this.connectionId)},n.prototype.createTransport=function(n,t,i,o){return f(this,void 0,void 0,function(){var c,f,h,l,s,a;return e(this,function(e){switch(e.label){case 0:return(this.updateConnectionId(t),!this.isITransport(n))?[3,2]:(this.logger.log(u.LogLevel.Trace,"Connection was provided an instance of ITransport, using that directly."),this.transport=n,[4,this.transport.connect(this.url,i,this)]);case 1:return e.sent(),this.changeState(0,1),[2];case 2:c=t.availableTransports;f=0;h=c;e.label=3;case 3:return(f<h.length)?(l=h[f],this.connectionState=0,s=this.resolveTransport(l,n,i),!(typeof s=="number"))?[3,8]:(this.transport=this.constructTransport(s),!(t.connectionId===null))?[3,5]:[4,this.getNegotiationResponse(o)]:[3,9];case 4:t=e.sent();this.updateConnectionId(t);e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.transport.connect(this.url,i,this)];case 6:return e.sent(),this.changeState(0,1),[2];case 7:return a=e.sent(),this.logger.log(u.LogLevel.Error,"Failed to start the transport '"+r.TransportType[s]+"': "+a),this.connectionState=2,t.connectionId=null,[3,8];case 8:return f++,[3,3];case 9:throw new Error("Unable to initialize any of the available transports.");}})})},n.prototype.constructTransport=function(n){switch(n){case r.TransportType.WebSockets:return new r.WebSocketTransport(this.options.accessTokenFactory,this.logger);case r.TransportType.ServerSentEvents:return new r.ServerSentEventsTransport(this.httpClient,this.options.accessTokenFactory,this.logger);case r.TransportType.LongPolling:return new r.LongPollingTransport(this.httpClient,this.options.accessTokenFactory,this.logger);default:throw new Error("Unknown transport: "+n+".");}},n.prototype.resolveTransport=function(n,t,i){var f=r.TransportType[n.transport],e;if(f===null||f===undefined)this.logger.log(u.LogLevel.Trace,"Skipping transport '"+n.transport+"' because it is not supported by this client.");else if(e=n.transferFormats.map(function(n){return r.TransferFormat[n]}),t&&f!==t)this.logger.log(u.LogLevel.Trace,"Skipping transport '"+r.TransportType[f]+"' because it was disabled by the client.");else if(e.indexOf(i)>=0)if(f===r.TransportType.WebSockets&&typeof WebSocket=="undefined"||f===r.TransportType.ServerSentEvents&&typeof EventSource=="undefined")this.logger.log(u.LogLevel.Trace,"Skipping transport '"+r.TransportType[f]+"' because it is not supported in your environment.'");else return this.logger.log(u.LogLevel.Trace,"Selecting transport '"+r.TransportType[f]+"'"),f;else this.logger.log(u.LogLevel.Trace,"Skipping transport '"+r.TransportType[f]+"' because it does not support the requested transfer format '"+r.TransferFormat[i]+"'.");return null},n.prototype.isITransport=function(n){return typeof n=="object"&&"connect"in n},n.prototype.changeState=function(n,t){return this.connectionState===n?(this.connectionState=t,!0):!1},n.prototype.send=function(n){if(this.connectionState!==1)throw new Error("Cannot send data if the connection is not in the 'Connected' State.");return this.transport.send(n)},n.prototype.stop=function(n){return f(this,void 0,void 0,function(){var t,i;return e(this,function(r){switch(r.label){case 0:t=this.connectionState;this.connectionState=2;r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.startPromise];case 2:return r.sent(),[3,4];case 3:return i=r.sent(),[3,4];case 4:return this.stopConnection(t===1,n),[2]}})})},n.prototype.stopConnection=function(n,t){if(this.transport&&(this.transport.stop(),this.transport=null),t?this.logger.log(u.LogLevel.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(u.LogLevel.Information,"Connection disconnected."),this.connectionState=2,n&&this.onclose)this.onclose(t)},n.prototype.resolveUrl=function(n){var t,r,i;if(n.lastIndexOf("https://",0)===0||n.lastIndexOf("http://",0)===0)return n;if(typeof window=="undefined"||!window||!window.document)throw new Error("Cannot resolve '"+n+"'.");return t=window.document.createElement("a"),t.href=n,r=!t.protocol||t.protocol===":"?window.document.location.protocol+"//"+(t.host||window.document.location.host):t.protocol+"//"+t.host,n&&n[0]==="/"||(n="/"+n),i=r+n,this.logger.log(u.LogLevel.Information,"Normalizing '"+n+"' to '"+i+"'."),i},n.prototype.resolveNegotiateUrl=function(n){var i=n.indexOf("?"),t=n.substring(0,i===-1?n.length:i);return t[t.length-1]!=="/"&&(t+="/"),t+="negotiate",t+(i===-1?"":n.substring(i))},n}();i.HttpConnection=c},{"./HttpClient":3,"./ILogger":7,"./Loggers":9,"./Transports":12,"./Utils":13}],5:[function(n,t,i){"use strict";var e=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},o=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e};Object.defineProperty(i,"__esModule",{value:!0});var s=n("./HttpConnection"),r=n("./ILogger"),f=n("./JsonHubProtocol");i.JsonHubProtocol=f.JsonHubProtocol;var h=n("./Loggers"),c=n("./Observable"),u=n("./TextMessageFormat"),l=3e4,a=function(){function n(n,t){t===void 0&&(t={});var i=this;t=t||{};this.timeoutInMilliseconds=t.timeoutInMilliseconds||l;this.protocol=t.protocol||new f.JsonHubProtocol;this.connection=typeof n=="string"?new s.HttpConnection(n,t):n;this.logger=h.LoggerFactory.createLogger(t.logger);this.connection.onreceive=function(n){return i.processIncomingData(n)};this.connection.onclose=function(n){return i.connectionClosed(n)};this.callbacks={};this.methods={};this.closedCallbacks=[];this.id=0}return n.prototype.processIncomingData=function(n){var e,i,u,t,f;if(this.cleanupTimeout(),this.receivedHandshakeResponse||(n=this.processHandshakeResponse(n),this.receivedHandshakeResponse=!0),n)for(e=this.protocol.parseMessages(n,this.logger),i=0,u=e;i<u.length;i++){t=u[i];switch(t.type){case 1:this.invokeClientMethod(t);break;case 2:case 3:f=this.callbacks[t.invocationId];f!=null&&(t.type===3&&delete this.callbacks[t.invocationId],f(t));break;case 6:break;case 7:this.logger.log(r.LogLevel.Information,"Close message received from server.");this.connection.stop(t.error?new Error("Server returned an error on close: "+t.error):null);break;default:this.logger.log(r.LogLevel.Warning,"Invalid message type: "+t.type)}}this.configureTimeout()},n.prototype.processHandshakeResponse=function(n){var s,h,c,e,o,i,t,a,l,f;try{if(n instanceof ArrayBuffer){if(e=new Uint8Array(n),i=e.indexOf(u.TextMessageFormat.RecordSeparatorCode),i===-1)throw new Error("Message is incomplete.");t=i+1;h=String.fromCharCode.apply(null,e.slice(0,t));c=e.byteLength>t?e.slice(t).buffer:null}else{if(o=n,i=o.indexOf(u.TextMessageFormat.RecordSeparator),i===-1)throw new Error("Message is incomplete.");t=i+1;h=o.substring(0,t);c=o.length>t?o.substring(t):null}a=u.TextMessageFormat.parse(h);s=JSON.parse(a[0])}catch(v){f="Error parsing handshake response: "+v;this.logger.log(r.LogLevel.Error,f);l=new Error(f);this.connection.stop(l);throw l;}return s.error?(f="Server returned handshake error: "+s.error,this.logger.log(r.LogLevel.Error,f),this.connection.stop(new Error(f))):this.logger.log(r.LogLevel.Trace,"Server handshake complete."),c},n.prototype.configureTimeout=function(){var n=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return n.serverTimeout()},this.timeoutInMilliseconds))},n.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},n.prototype.invokeClientMethod=function(n){var u=this,i=this.methods[n.target.toLowerCase()],t;i?(i.forEach(function(t){return t.apply(u,n.arguments)}),n.invocationId&&(t="Server requested a response, which is not supported in this version of the client.",this.logger.log(r.LogLevel.Error,t),this.connection.stop(new Error(t)))):this.logger.log(r.LogLevel.Warning,"No client method with the name '"+n.target+"' found.")},n.prototype.connectionClosed=function(n){var i=this,t=this.callbacks;this.callbacks={};Object.keys(t).forEach(function(i){var r=t[i];r(undefined,n?n:new Error("Invocation canceled due to connection being closed."))});this.cleanupTimeout();this.closedCallbacks.forEach(function(t){return t.apply(i,[n])})},n.prototype.start=function(){return e(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return this.logger.log(r.LogLevel.Trace,"Starting HubConnection."),this.receivedHandshakeResponse=!1,[4,this.connection.start(this.protocol.transferFormat)];case 1:return n.sent(),this.logger.log(r.LogLevel.Trace,"Sending handshake request."),[4,this.connection.send(u.TextMessageFormat.write(JSON.stringify({protocol:this.protocol.name,version:this.protocol.version})))];case 2:return n.sent(),this.logger.log(r.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.configureTimeout(),[2]}})})},n.prototype.stop=function(){return this.logger.log(r.LogLevel.Trace,"Stopping HubConnection."),this.cleanupTimeout(),this.connection.stop()},n.prototype.stream=function(n){for(var i,t,e,r=this,f=[],u=1;u<arguments.length;u++)f[u-1]=arguments[u];return i=this.createStreamInvocation(n,f),t=new c.Subject(function(){var n=r.createCancelInvocation(i.invocationId),t=r.protocol.writeMessage(n);return delete r.callbacks[i.invocationId],r.connection.send(t)}),this.callbacks[i.invocationId]=function(n,i){if(i){t.error(i);return}n.type===3?n.error?t.error(new Error(n.error)):t.complete():t.next(n.item)},e=this.protocol.writeMessage(i),this.connection.send(e).catch(function(n){t.error(n);delete r.callbacks[i.invocationId]}),t},n.prototype.send=function(n){for(var r,u,i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];return r=this.createInvocation(n,i,!0),u=this.protocol.writeMessage(r),this.connection.send(u)},n.prototype.invoke=function(n){for(var r,f,t=this,u=[],i=1;i<arguments.length;i++)u[i-1]=arguments[i];return r=this.createInvocation(n,u,!1),f=new Promise(function(n,i){t.callbacks[r.invocationId]=function(t,r){if(r){i(r);return}if(t.type===3){var u=t;u.error?i(new Error(u.error)):n(u.result)}else i(new Error("Unexpected message type: "+t.type))};var u=t.protocol.writeMessage(r);t.connection.send(u).catch(function(n){i(n);delete t.callbacks[r.invocationId]})}),f},n.prototype.on=function(n,t){n&&t&&(n=n.toLowerCase(),this.methods[n]||(this.methods[n]=[]),this.methods[n].indexOf(t)===-1)&&this.methods[n].push(t)},n.prototype.off=function(n,t){var i,r;n&&(n=n.toLowerCase(),i=this.methods[n],i)&&(t?(r=i.indexOf(t),r!==-1&&(i.splice(r,1),i.length===0&&delete this.methods[n])):delete this.methods[n])},n.prototype.onclose=function(n){n&&this.closedCallbacks.push(n)},n.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},n.prototype.createInvocation=function(n,t,i){if(i)return{arguments:t,target:n,type:1};var r=this.id;return this.id++,{arguments:t,invocationId:r.toString(),target:n,type:1}},n.prototype.createStreamInvocation=function(n,t){var i=this.id;return this.id++,{arguments:t,invocationId:i.toString(),target:n,type:4}},n.prototype.createCancelInvocation=function(n){return{invocationId:n,type:5}},n}();i.HubConnection=a},{"./HttpConnection":4,"./ILogger":7,"./JsonHubProtocol":8,"./Loggers":9,"./Observable":10,"./TextMessageFormat":11}],6:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0})},{}],7:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r;(function(n){n[n.Trace=0]="Trace";n[n.Information=1]="Information";n[n.Warning=2]="Warning";n[n.Error=3]="Error";n[n.None=4]="None"})(r=i.LogLevel||(i.LogLevel={}))},{}],8:[function(n,t,i){"use strict";var u;Object.defineProperty(i,"__esModule",{value:!0});var f=n("./ILogger"),e=n("./Loggers"),r=n("./TextMessageFormat"),o=n("./Transports");i.JSON_HUB_PROTOCOL_NAME="json";u=function(){function n(){this.name=i.JSON_HUB_PROTOCOL_NAME;this.version=1;this.transferFormat=o.TransferFormat.Text}return n.prototype.parseMessages=function(n,t){var h,o,u,s,c,i;if(!n)return[];for(t===null&&(t=new e.NullLogger),h=r.TextMessageFormat.parse(n),o=[],u=0,s=h;u<s.length;u++){if(c=s[u],i=JSON.parse(c),typeof i.type!="number")throw new Error("Invalid payload.");switch(i.type){case 1:this.isInvocationMessage(i);break;case 2:this.isStreamItemMessage(i);break;case 3:this.isCompletionMessage(i);break;case 6:break;case 7:break;default:t.log(f.LogLevel.Information,"Unknown message type '"+i.type+"' ignored.");continue}o.push(i)}return o},n.prototype.writeMessage=function(n){return r.TextMessageFormat.write(JSON.stringify(n))},n.prototype.isInvocationMessage=function(n){this.assertNotEmptyString(n.target,"Invalid payload for Invocation message.");n.invocationId!==undefined&&this.assertNotEmptyString(n.invocationId,"Invalid payload for Invocation message.")},n.prototype.isStreamItemMessage=function(n){if(this.assertNotEmptyString(n.invocationId,"Invalid payload for StreamItem message."),n.item===undefined)throw new Error("Invalid payload for StreamItem message.");},n.prototype.isCompletionMessage=function(n){if(n.result&&n.error)throw new Error("Invalid payload for Completion message.");!n.result&&n.error&&this.assertNotEmptyString(n.error,"Invalid payload for Completion message.");this.assertNotEmptyString(n.invocationId,"Invalid payload for Completion message.")},n.prototype.assertNotEmptyString=function(n,t){if(typeof n!="string"||n==="")throw new Error(t);},n}();i.JsonHubProtocol=u},{"./ILogger":7,"./Loggers":9,"./TextMessageFormat":11,"./Transports":12}],9:[function(n,t,i){"use strict";var r,f,u,e;Object.defineProperty(i,"__esModule",{value:!0});r=n("./ILogger");f=function(){function n(){}return n.prototype.log=function(){},n}();i.NullLogger=f;u=function(){function n(n){this.minimumLogLevel=n}return n.prototype.log=function(n,t){if(n>=this.minimumLogLevel)switch(n){case r.LogLevel.Error:console.error(r.LogLevel[n]+": "+t);break;case r.LogLevel.Warning:console.warn(r.LogLevel[n]+": "+t);break;case r.LogLevel.Information:console.info(r.LogLevel[n]+": "+t);break;default:console.log(r.LogLevel[n]+": "+t)}},n}();i.ConsoleLogger=u;e=function(){function n(){}return n.createLogger=function(n){return n===undefined?new u(r.LogLevel.Information):n===null?new f:n.log?n:new u(n)},n}();i.LoggerFactory=e},{"./ILogger":7}],10:[function(n,t,i){"use strict";var r,u;Object.defineProperty(i,"__esModule",{value:!0});r=function(){function n(n,t){this.subject=n;this.observer=t}return n.prototype.dispose=function(){var n=this.subject.observers.indexOf(this.observer);n>-1&&this.subject.observers.splice(n,1);this.subject.observers.length===0&&this.subject.cancelCallback().catch(function(){})},n}();i.Subscription=r;u=function(){function n(n){this.observers=[];this.cancelCallback=n}return n.prototype.next=function(n){for(var r,t=0,i=this.observers;t<i.length;t++)r=i[t],r.next(n)},n.prototype.error=function(n){for(var r,t=0,i=this.observers;t<i.length;t++)r=i[t],r.error&&r.error(n)},n.prototype.complete=function(){for(var i,n=0,t=this.observers;n<t.length;n++)i=t[n],i.complete&&i.complete()},n.prototype.subscribe=function(n){return this.observers.push(n),new r(this,n)},n}();i.Subject=u},{}],11:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(){}return n.write=function(t){return""+t+n.RecordSeparator},n.parse=function(t){if(t[t.length-1]!==n.RecordSeparator)throw new Error("Message is incomplete.");var i=t.split(n.RecordSeparator);return i.pop(),i},n.RecordSeparatorCode=30,n.RecordSeparator=String.fromCharCode(n.RecordSeparatorCode),n}();i.TextMessageFormat=r},{}],12:[function(n,t,i){"use strict";function e(n){var t=null;return n instanceof ArrayBuffer?t="Binary data of length "+n.byteLength:typeof n=="string"&&(t="String data of length "+n.length),t}function v(n,t,i,u,f,h){return o(this,void 0,void 0,function(){var c,l,a,o;return s(this,function(s){switch(s.label){case 0:return l=f(),l&&(c=(o={},o.Authorization="Bearer "+f(),o)),n.log(r.LogLevel.Trace,"("+t+" transport) sending data. "+e(h)+"."),[4,i.post(u,{content:h,headers:c})];case 1:return a=s.sent(),n.log(r.LogLevel.Trace,"("+t+" transport) request complete. Response status: "+a.statusCode+"."),[2]}})})}var o=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},s=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e},f,c,l,a;Object.defineProperty(i,"__esModule",{value:!0});var y=n("./AbortController"),h=n("./Errors"),r=n("./ILogger"),u=n("./Utils"),p;(function(n){n[n.WebSockets=0]="WebSockets";n[n.ServerSentEvents=1]="ServerSentEvents";n[n.LongPolling=2]="LongPolling"})(p=i.TransportType||(i.TransportType={})),function(n){n[n.Text=1]="Text";n[n.Binary=2]="Binary"}(f=i.TransferFormat||(i.TransferFormat={}));c=function(){function n(n,t){this.logger=t;this.accessTokenFactory=n||function(){return null}}return n.prototype.connect=function(n,t,i){var o=this;if(u.Arg.isRequired(n,"url"),u.Arg.isRequired(t,"transferFormat"),u.Arg.isIn(t,f,"transferFormat"),u.Arg.isRequired(i,"connection"),typeof WebSocket=="undefined")throw new Error("'WebSocket' is not supported in your environment.");return this.logger.log(r.LogLevel.Trace,"(WebSockets transport) Connecting"),new Promise(function(i,u){var h,s;n=n.replace(/^http/,"ws");h=o.accessTokenFactory();h&&(n+=(n.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(h)));s=new WebSocket(n);t===f.Binary&&(s.binaryType="arraybuffer");s.onopen=function(){o.logger.log(r.LogLevel.Information,"WebSocket connected to "+n);o.webSocket=s;i()};s.onerror=function(n){u(n.error)};s.onmessage=function(n){if(o.logger.log(r.LogLevel.Trace,"(WebSockets transport) data received. "+e(n.data)+"."),o.onreceive)o.onreceive(n.data)};s.onclose=function(n){if(o.onclose&&o.webSocket)if(n.wasClean===!1||n.code!==1e3)o.onclose(new Error("Websocket closed with status code: "+n.code+" ("+n.reason+")"));else o.onclose()}})},n.prototype.send=function(n){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.logger.log(r.LogLevel.Trace,"(WebSockets transport) sending data. "+e(n)+"."),this.webSocket.send(n),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},n.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},n}();i.WebSocketTransport=c;l=function(){function n(n,t,i){this.httpClient=n;this.accessTokenFactory=t||function(){return null};this.logger=i}return n.prototype.connect=function(n,t,i){var o=this;if(u.Arg.isRequired(n,"url"),u.Arg.isRequired(t,"transferFormat"),u.Arg.isIn(t,f,"transferFormat"),u.Arg.isRequired(i,"connection"),typeof EventSource=="undefined")throw new Error("'EventSource' is not supported in your environment.");return this.logger.log(r.LogLevel.Trace,"(SSE transport) Connecting"),this.url=n,new Promise(function(i,u){var h,s;t!==f.Text&&u(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));h=o.accessTokenFactory();h&&(n+=(n.indexOf("?")<0?"?":"&")+("access_token="+encodeURIComponent(h)));s=new EventSource(n,{withCredentials:!0});try{s.onmessage=function(n){if(o.onreceive)try{o.logger.log(r.LogLevel.Trace,"(SSE transport) data received. "+e(n.data)+".");o.onreceive(n.data)}catch(t){if(o.onclose)o.onclose(t);return}};s.onerror=function(n){if(u(new Error(n.message||"Error occurred")),o.eventSource&&o.onclose)o.onclose(new Error(n.message||"Error occurred"))};s.onopen=function(){o.logger.log(r.LogLevel.Information,"SSE connected to "+o.url);o.eventSource=s;i()}}catch(c){return Promise.reject(c)}})},n.prototype.send=function(n){return o(this,void 0,void 0,function(){return s(this,function(){return[2,v(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,n)]})})},n.prototype.stop=function(){return this.eventSource&&(this.eventSource.close(),this.eventSource=null),Promise.resolve()},n}();i.ServerSentEventsTransport=l;a=function(){function n(n,t,i){this.httpClient=n;this.accessTokenFactory=t||function(){return null};this.logger=i;this.pollAbort=new y.AbortController}return n.prototype.connect=function(n,t,i){if(u.Arg.isRequired(n,"url"),u.Arg.isRequired(t,"transferFormat"),u.Arg.isIn(t,f,"transferFormat"),u.Arg.isRequired(i,"connection"),this.url=n,this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Connecting"),i.features.inherentKeepAlive=!0,t===f.Binary&&typeof(new XMLHttpRequest).responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return this.poll(this.url,t),Promise.resolve()},n.prototype.poll=function(n,t){return o(this,void 0,void 0,function(){var u,o,c,i,l;return s(this,function(s){switch(s.label){case 0:u={abortSignal:this.pollAbort.signal,headers:{},timeout:9e4};t===f.Binary&&(u.responseType="arraybuffer");o=this.accessTokenFactory();o&&(u.headers.Authorization="Bearer "+o);s.label=1;case 1:if(!!this.pollAbort.signal.aborted)return[3,6];s.label=2;case 2:return s.trys.push([2,4,,5]),c=n+"&_="+Date.now(),this.logger.log(r.LogLevel.Trace,"(LongPolling transport) polling: "+c),[4,this.httpClient.get(c,u)];case 3:if(i=s.sent(),i.statusCode===204)this.logger.log(r.LogLevel.Information,"(LongPolling transport) Poll terminated by server"),this.onclose&&this.onclose(),this.pollAbort.abort();else if(i.statusCode!==200){if(this.logger.log(r.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+i.statusCode),this.onclose)this.onclose(new h.HttpError(i.statusText,i.statusCode));this.pollAbort.abort()}else if(i.content){if(this.logger.log(r.LogLevel.Trace,"(LongPolling transport) data received. "+e(i.content)+"."),this.onreceive)this.onreceive(i.content)}else this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing.");return[3,5];case 4:if(l=s.sent(),l instanceof h.TimeoutError)this.logger.log(r.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing.");else{if(this.onclose)this.onclose(l);this.pollAbort.abort()}return[3,5];case 5:return[3,1];case 6:return[2]}})})},n.prototype.send=function(n){return o(this,void 0,void 0,function(){return s(this,function(){return[2,v(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,n)]})})},n.prototype.stop=function(){return this.pollAbort.abort(),Promise.resolve()},n}();i.LongPollingTransport=a},{"./AbortController":1,"./Errors":2,"./ILogger":7,"./Utils":13}],13:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function n(){}return n.isRequired=function(n,t){if(n===null||n===undefined)throw new Error("The '"+t+"' argument is required.");},n.isIn=function(n,t,i){if(!(n in t))throw new Error("Unknown "+i+" value: "+n+".");},n}();i.Arg=r},{}],14:[function(n,t,i){"use strict";function r(n){for(var t in n)i.hasOwnProperty(t)||(i[t]=n[t])}Object.defineProperty(i,"__esModule",{value:!0});r(n("./Errors"));r(n("./HttpClient"));r(n("./HttpConnection"));r(n("./HubConnection"));r(n("./IHubProtocol"));r(n("./ILogger"));r(n("./Loggers"));r(n("./Transports"));r(n("./Observable"))},{"./Errors":2,"./HttpClient":3,"./HttpConnection":4,"./HubConnection":5,"./IHubProtocol":6,"./ILogger":7,"./Loggers":9,"./Observable":10,"./Transports":12}],15:[function(n,t,i){"use strict";function u(){for(var t=[],n,r=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<r.length;i++)n=r[i].split("="),t.push(n[0]),t[n[0]]=n[1];return t}Object.defineProperty(i,"__esModule",{value:!0});var r=n("@aspnet/signalr");$(document).ready(function(){function v(n){s||(f.invoke("JoinCanvas",n),e=n)}function w(n){var r=i[n.artistid];r.PreviousPoint!=null&&(t.beginPath(),t.moveTo(r.PreviousPoint.x,r.PreviousPoint.y),t.lineTo(n.x,n.y),t.strokeStyle=r.rgb,t.lineWidth=1,t.stroke(),t.closePath());i[n.artistid].PreviousPoint=n}function c(t){(t.preventDefault(),t.touches&&(t=t.touches[0]),s&&o)&&f.invoke("Draw",t.clientX-n.offsetLeft,t.clientY-n.offsetTop,e,h)}function y(n){n.preventDefault();o=!0;c(n)}function p(n){n.preventDefault();o=!1;f.invoke("ClearPoint",e,h)}var e="",o=!1,s=!1,h,i=[],l=u(),b=$("#joinCanvasId"),a=$("#startModal"),n=$("#canvas")[0],t=n.getContext("2d"),f=new r.HubConnection(new r.HttpConnection("/hubs/drawing",{transport:r.TransportType.WebSockets,logger:r.LogLevel.None}),{logger:r.LogLevel.None});t.canvas.width=document.body.clientWidth;t.canvas.height=document.body.clientHeight;f.start().then(function(){l.canvasid?v(l.canvasid):a.modal("show")}).catch(function(n){console.log(n);alert("Error: Could not connect to the server.")});a.on("hidden.bs.modal",function(){v($("#shareCanvasId").text())});f.on("NewPoint",function(n){if(i[n.artistid].PreviousPoint!=null)return w(n);i[n.artistid].PreviousPoint=n.x!=null?n:null});f.on("NewArtist",function(n){i=n});f.on("ClearPoint",function(n){i[n].PreviousPoint=null});f.on("JoinedCanvas",function(n,t){h=n;i=t;s=!0});n.addEventListener("mousemove",c.bind(null),!1);n.addEventListener("touchmove",c.bind(null),!1);n.addEventListener("mousedown",y.bind(null),!1);n.addEventListener("touchstart",y.bind(null),!1);n.addEventListener("mouseup",p.bind(null),!1);n.addEventListener("touchend",p.bind(null),!1)})},{"@aspnet/signalr":14}]},{},[15]);